#! /bin/sh
#
### BEGIN INIT INFO
# Provides:             exhibitor server
# Required-Start:       $syslog
# Required-Stop:        $syslog
# Should-Start:         $local_fs $network
# Should-Stop:          $local_fs $network
# Default-Start:        2 3 4 5
# Default-Stop:         0 1 6
# Short-Description:    Start the Exhibitor process
### END INIT INFO

PATH=/sbin:/bin:/usr/sbin:/usr/bin
DAEMON=/usr/bin/java
DAEMON_SCRIPT="-jar \
    <%= @jar %> \
    <%= @opts.keys.sort.map { |k| "--#{k.to_s} #{@opts[k]}" }.join(" ") %>"
#SCRIPT_PATH=
NAME=exhibitor
DESC="Exhibitor"
RUNDIR=/var/run/$NAME
USER=<%= @user %>
GROUP=<%= @group %>
PIDFILE=$RUNDIR/$NAME.pid

# How long to wait for the process to die on stop/restart
stoptimeout=5

test -x $DAEMON || exit 0

DAEMON_OPTS=""

start() {
        # Create the run directory if it doesn't exist
        if [ ! -d "$RUNDIR" ]; then
                install -o "$USER" -g "$GROUP" -m 755 -d "$RUNDIR" || return 2
        fi

        start-stop-daemon --start -q -b --chuid $USER:$GROUP --pidfile "$PIDFILE" --exec "$DAEMON" -- $DAEMON_SCRIPT
        ret=$?
        exit $ret
}

stop() {
        start-stop-daemon --stop --retry "$stoptimeout" --exec "$DAEMON"
}

case "$1" in
  start)
        echo -n "Starting $DESC: "
        start
        echo "$NAME."
        ;;
  stop)
        echo -n "Stopping $DESC: "
        stop
        echo "$NAME."
        ;;
  restart)
        echo -n "Restarting $DESC: "
       stop
        start
        echo "$NAME."
        ;;
  *)
        N=/etc/init.d/$NAME
        echo "Usage: $N {start|stop|restart}" >&2
        exit 1
        ;;
esac

exit 0
